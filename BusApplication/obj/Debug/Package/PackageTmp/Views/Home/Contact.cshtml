<!DOCTYPE html>
<html lang="hu">
<head>
    <style>
        #mapid {
            height: 600px;
        }
    </style>
    <meta charset="utf-8" />
    <link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport"
          content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="theme-color" content="#000000" />

    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"
          integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
          crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"
            integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg=="
            crossorigin=""></script>
</head>
<body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <p>Leaftlet</p>
    <div id="mapid"></div>
    <script>
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition);
            } else {
                alert("Geolocation is not supported by this browser.");
            }
        }

        function showPosition(position) {
            marker = L.marker([position.coords.latitude, position.coords.longitude]).addTo(mymap);
            //console.log(position.coords.latitude + " " + position.coords.longitude);
            marker.bindPopup("<b>Hello user!</b><br>That's your location.").openPopup();
        }

        var busList = [];
        @foreach (var bus in ViewBag.Buses)
        {
           @:busList.push({ "Id": "@bus.Id", "BusId": "@bus.BusId", "Longitude": parseFloat("@bus.Longitude".replace(',', '.')),"Latitude": parseFloat("@bus.Latitude".replace(',', '.'))});
        }
        
        var marker;
        var mymap = L.map('mapid').setView([46.5, 24,39], 13);
        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1Ijoiam9yZHkzMyIsImEiOiJjanRnMWNqaXUxejMzNDl0NTFrdXZrMzhoIn0.UMMjORn922XIANL-aOc8zA', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox.streets',
            accessToken: 'your.mapbox.access.token'
        }).addTo(mymap);

        document.body.onload = getLocation;
        
        



        /*
        L.Routing.control({
            waypoints: [
                L.latLng(46.523454, 24.598617),
                L.latLng(46.5117342, 24.5110409)
            ],
            routeWhileDragging: true
        }).addTo(mymap);
        */
        
        busList.forEach(function (s) {
            marker = L.marker([s.Latitude, s.Longitude]).addTo(mymap);
            marker.bindPopup("<b>" + s.Id + "</b><br>" + s.BusId);
        });
        /*
        var circle = L.circle([46.523674547994766, 24.599113591698256], {
            color: 'red',
            fillColor: '#f03',
            fillOpacity: 0.5,
            radius: 50
        }).addTo(mymap);
        var polygon = L.polygon([
            [46.522812, 24.598669],
            [46.522812, 24.598669],
            [46.522812, 24.598669]
        ]).addTo(mymap);
        

        polygon.bindPopup("I am a polygon.");
        var popup = L.popup()
            .setLatLng([46.523454, 24.598617])
            .setContent("I am a standalone popup.")
            .openOn(mymap);
            */


        function onMapClick(e) {
            alert("You clicked the map at " + e.latlng);
        }

        //mymap.on('click', onMapClick);
    </script>
</body>
</html>